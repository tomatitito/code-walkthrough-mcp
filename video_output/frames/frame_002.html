
  <!DOCTYPE html>
  <html>
  <head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/tokyo-night-dark.min.css">
    <style>
      @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Roboto:wght@400;700&display=swap');
      body {
        margin: 0;
        padding: 60px;
        background: #1a1b26;
        color: #c0caf5;
        font-family: 'Roboto', sans-serif;
        height: 100vh;
        display: flex;
        flex-direction: column;
      }
      h2 {
        font-family: 'Roboto', sans-serif;
        font-size: 42px;
        margin-bottom: 10px;
        font-weight: 700;
      }
      .stats {
        font-family: 'JetBrains Mono', monospace;
        font-size: 22px;
        color: #7aa2f7;
        margin-bottom: 30px;
      }
      .additions { color: #9ece6a; }
      .deletions { color: #f7768e; }
      pre {
        background: #24283b;
        padding: 30px;
        border-radius: 12px;
        overflow-x: auto;
        font-family: 'JetBrains Mono', monospace;
        font-size: 16px;
        line-height: 1.8;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        border: 1px solid #414868;
      }
      .hljs-meta { display: none; }
    </style>
  </head>
  <body>
    <h2>index.ts</h2>
    <div class="stats">
      <span class="additions">+191</span>
      <span class="deletions">-9</span>
      <span style="margin-left: 20px;">modified</span>
    </div>
    <pre><code class="hljs"><span class="hljs-comment">diff --git a/index.ts b/index.ts</span>
<span class="hljs-comment">index 3489b93..32705d2 100644</span>
<span class="hljs-comment">--- a/index.ts</span>
<span class="hljs-comment">+++ b/index.ts</span>
<span class="hljs-meta">@@ -11,6 +11,7 @@</span> import * as fs from &#x27;fs/promises&#x27;;
 import * as path from &#x27;path&#x27;;
 import { HtmlToPngConverter } from &#x27;./html-to-png.js&#x27;;
 import hljs from &#x27;highlight.js&#x27;;
<span class="hljs-addition">+import { TextToSpeechConverter } from &#x27;./tts.js&#x27;;</span>
 
 const execAsync = promisify(exec);
 
<span class="hljs-meta">@@ -141,6 +142,43 @@</span> export class GitCommitVideoServer {
             required: [&quot;framesDir&quot;, &quot;outputPath&quot;],
           },
         },
<span class="hljs-addition">+        {</span>
<span class="hljs-addition">+          name: &quot;generate_audio&quot;,</span>
<span class="hljs-addition">+          description: &quot;Generate an audio file from text using a TTS service&quot;,</span>
<span class="hljs-addition">+          inputSchema: {</span>
<span class="hljs-addition">+            type: &quot;object&quot;,</span>
<span class="hljs-addition">+            properties: {</span>
<span class="hljs-addition">+              text: {</span>
<span class="hljs-addition">+                type: &quot;string&quot;,</span>
<span class="hljs-addition">+                description: &quot;The text to synthesize&quot;,</span>
<span class="hljs-addition">+              },</span>
<span class="hljs-addition">+              outputFile: {</span>
<span class="hljs-addition">+                type: &quot;string&quot;,</span>
<span class="hljs-addition">+                description: &quot;Path to save the audio file&quot;,</span>
<span class="hljs-addition">+              },</span>
<span class="hljs-addition">+            },</span>
<span class="hljs-addition">+            required: [&quot;text&quot;, &quot;outputFile&quot;],</span>
<span class="hljs-addition">+          },</span>
<span class="hljs-addition">+        },</span>
<span class="hljs-addition">+        {</span>
<span class="hljs-addition">+          name: &quot;generate_full_script&quot;,</span>
<span class="hljs-addition">+          description: &quot;Generate a complete narrative script for TTS from commit information&quot;,</span>
<span class="hljs-addition">+          inputSchema: {</span>
<span class="hljs-addition">+            type: &quot;object&quot;,</span>
<span class="hljs-addition">+            properties: {</span>
<span class="hljs-addition">+              commitInfo: {</span>
<span class="hljs-addition">+                type: &quot;object&quot;,</span>
<span class="hljs-addition">+                description: &quot;Commit information from analyze_commit&quot;,</span>
<span class="hljs-addition">+              },</span>
<span class="hljs-addition">+              style: {</span>
<span class="hljs-addition">+                type: &quot;string&quot;,</span>
<span class="hljs-addition">+                description: &quot;Presentation style: &#x27;technical&#x27;, &#x27;beginner&#x27;, &#x27;overview&#x27;&quot;,</span>
<span class="hljs-addition">+                enum: [&quot;technical&quot;, &quot;beginner&quot;, &quot;overview&quot;],</span>
<span class="hljs-addition">+              },</span>
<span class="hljs-addition">+            },</span>
<span class="hljs-addition">+            required: [&quot;commitInfo&quot;],</span>
<span class="hljs-addition">+          },</span>
<span class="hljs-addition">+        },</span>
       ],
     }));
 
<span class="hljs-meta">@@ -171,6 +209,12 @@</span> export class GitCommitVideoServer {
               (args.fps as number) || 2
             );
 
<span class="hljs-addition">+          case &quot;generate_audio&quot;:</span>
<span class="hljs-addition">+            return await this.generateAudio(args.text as string, args.outputFile as string);</span>
<span class="hljs-addition">+</span>
<span class="hljs-addition">+          case &quot;generate_full_script&quot;:</span>
<span class="hljs-addition">+            return await this.generateFullScript(args.commitInfo as object, (args.style as string) || &quot;technical&quot;);</span>
<span class="hljs-addition">+</span>
           default:
             throw new Error(`Unknown tool: ${name}`);
         }
<span class="hljs-meta">@@ -187,6 +231,67 @@</span> export class GitCommitVideoServer {
     });
   }
 
<span class="hljs-addition">+  private async generateAudio(text: string, outputFile: string) {</span>
<span class="hljs-addition">+    const ttsConverter = new TextToSpeechConverter();</span>
<span class="hljs-addition">+    await ttsConverter.generateAudio(text, outputFile);</span>
<span class="hljs-addition">+    return {</span>
<span class="hljs-addition">+      content: [</span>
<span class="hljs-addition">+        {</span>
<span class="hljs-addition">+          type: &quot;text&quot;,</span>
<span class="hljs-addition">+          text: `Audio content written to file: ${outputFile}`,</span>
<span class="hljs-addition">+        },</span>
<span class="hljs-addition">+      ],</span>
<span class="hljs-addition">+    };</span>
<span class="hljs-addition">+  }</span>
<span class="hljs-addition">+</span>
<span class="hljs-addition">+  private async generateFullScript(commitInfo: any, style: string) {</span>
<span class="hljs-addition">+    const script = {</span>
<span class="hljs-addition">+      intro: this.generateIntroduction(commitInfo, style),</span>
<span class="hljs-addition">+      sections: commitInfo.files.map((file: FileChange) =&gt; ({</span>
<span class="hljs-addition">+        file: file.path,</span>
<span class="hljs-addition">+        explanation: this.generateFileExplanation(file, style),</span>
<span class="hljs-addition">+        duration: this.calculateSectionDuration(file, style),</span>
<span class="hljs-addition">+      })),</span>
<span class="hljs-addition">+      outro: this.generateOutro(commitInfo, style),</span>
<span class="hljs-addition">+    };</span>
<span class="hljs-addition">+</span>
<span class="hljs-addition">+    // Generate full narrative text for TTS</span>
<span class="hljs-addition">+    const pauseShort = style === &quot;beginner&quot; ? &quot;. &quot; : &quot;. &quot;;</span>
<span class="hljs-addition">+    const pauseLong = style === &quot;beginner&quot; ? &quot;. ... &quot; : &quot;. &quot;;</span>
<span class="hljs-addition">+</span>
<span class="hljs-addition">+    let fullText = script.intro + pauseLong;</span>
<span class="hljs-addition">+</span>
<span class="hljs-addition">+    script.sections.forEach((section, index) =&gt; {</span>
<span class="hljs-addition">+      if (style === &quot;beginner&quot; &amp;&amp; index === 0) {</span>
<span class="hljs-addition">+        fullText += &quot;Let&#x27;s start by looking at the first file. &quot;;</span>
<span class="hljs-addition">+      } else if (style === &quot;beginner&quot; &amp;&amp; index &gt; 0) {</span>
<span class="hljs-addition">+        fullText += &quot;Next, let&#x27;s examine another file. &quot;;</span>
<span class="hljs-addition">+      }</span>
<span class="hljs-addition">+</span>
<span class="hljs-addition">+      fullText += section.explanation + pauseShort;</span>
<span class="hljs-addition">+</span>
<span class="hljs-addition">+      if (style === &quot;beginner&quot; &amp;&amp; index &lt; script.sections.length - 1) {</span>
<span class="hljs-addition">+        fullText += &quot;Moving on. &quot;;</span>
<span class="hljs-addition">+      }</span>
<span class="hljs-addition">+    });</span>
<span class="hljs-addition">+</span>
<span class="hljs-addition">+    fullText += pauseLong + script.outro;</span>
<span class="hljs-addition">+</span>
<span class="hljs-addition">+    return {</span>
<span class="hljs-addition">+      content: [</span>
<span class="hljs-addition">+        {</span>
<span class="hljs-addition">+          type: &quot;text&quot;,</span>
<span class="hljs-addition">+          text: JSON.stringify({</span>
<span class="hljs-addition">+            structured: script,</span>
<span class="hljs-addition">+            narrative: fullText,</span>
<span class="hljs-addition">+            totalDuration: script.sections.reduce((sum, section) =&gt; sum + section.duration, 0) +</span>
<span class="hljs-addition">+              (style === &quot;beginner&quot; ? 8 : style === &quot;overview&quot; ? 3 : 5)</span>
<span class="hljs-addition">+          }, null, 2),</span>
<span class="hljs-addition">+        },</span>
<span class="hljs-addition">+      ],</span>
<span class="hljs-addition">+    };</span>
<span class="hljs-addition">+  }</span>
<span class="hljs-addition">+</span>
   private async analyzeCommit(repoPath: string, commitHash: string) {
     this.git = simpleGit(repoPath);
 
<span class="hljs-meta">@@ -268,17 +373,14 @@</span> export class GitCommitVideoServer {
   }
 
   private async generateScript(commitInfo: any, style: string) {
<span class="hljs-deletion">-    // This would integrate with an LLM to generate natural language explanations</span>
     const script = {
<span class="hljs-deletion">-      intro: `This commit by ${commitInfo.author} ${commitInfo.message}`,</span>
<span class="hljs-addition">+      intro: this.generateIntroduction(commitInfo, style),</span>
       sections: commitInfo.files.map((file: FileChange) =&gt; ({
         file: file.path,
         explanation: this.generateFileExplanation(file, style),
<span class="hljs-deletion">-        duration: Math.max(3, file.additions + file.deletions) / 10, // seconds</span>
<span class="hljs-addition">+        duration: this.calculateSectionDuration(file, style),</span>
       })),
<span class="hljs-deletion">-      outro: `These changes affect ${commitInfo.files.length} file(s) with ${commitInfo.files.reduce((sum: number, f: FileChange) =&gt; sum + f.additions, 0)</span>
<span class="hljs-deletion">-        } additions and ${commitInfo.files.reduce((sum: number, f: FileChange) =&gt; sum + f.deletions, 0)</span>
<span class="hljs-deletion">-        } deletions.`,</span>
<span class="hljs-addition">+      outro: this.generateOutro(commitInfo, style),</span>
     };
 
     return {
<span class="hljs-meta">@@ -291,17 +393,97 @@</span> export class GitCommitVideoServer {
     };
   }
 
<span class="hljs-addition">+  private generateIntroduction(commitInfo: any, style: string): string {</span>
<span class="hljs-addition">+    const dateStr = new Date(commitInfo.date).toLocaleDateString();</span>
<span class="hljs-addition">+</span>
<span class="hljs-addition">+    if (style === &quot;beginner&quot;) {</span>
<span class="hljs-addition">+      return `Welcome to this code walkthrough! Today we&#x27;ll explore a commit made by ${commitInfo.author} on ${dateStr}. The commit message says: &quot;${commitInfo.message}&quot;. Let&#x27;s see what changes were made to the codebase.`;</span>
<span class="hljs-addition">+    } else if (style === &quot;overview&quot;) {</span>
<span class="hljs-addition">+      return `Commit ${commitInfo.hash.slice(0, 8)} by ${commitInfo.author}: ${commitInfo.message}`;</span>
<span class="hljs-addition">+    }</span>
<span class="hljs-addition">+</span>
<span class="hljs-addition">+    return `This is a technical walkthrough of commit ${commitInfo.hash.slice(0, 8)} by ${commitInfo.author}. The commit titled &quot;${commitInfo.message}&quot; was made on ${dateStr}. Let&#x27;s examine the changes in detail.`;</span>
<span class="hljs-addition">+  }</span>
<span class="hljs-addition">+</span>
<span class="hljs-addition">+  private generateOutro(commitInfo: any, style: string): string {</span>
<span class="hljs-addition">+    const totalAdditions = commitInfo.files.reduce((sum: number, f: FileChange) =&gt; sum + f.additions, 0);</span>
<span class="hljs-addition">+    const totalDeletions = commitInfo.files.reduce((sum: number, f: FileChange) =&gt; sum + f.deletions, 0);</span>
<span class="hljs-addition">+    const fileCount = commitInfo.files.length;</span>
<span class="hljs-addition">+</span>
<span class="hljs-addition">+    if (style === &quot;beginner&quot;) {</span>
<span class="hljs-addition">+      return `That concludes our walkthrough! This commit modified ${fileCount} file${fileCount &gt; 1 ? &#x27;s&#x27; : &#x27;&#x27;}, adding ${totalAdditions} new line${totalAdditions !== 1 ? &#x27;s&#x27; : &#x27;&#x27;} and removing ${totalDeletions} line${totalDeletions !== 1 ? &#x27;s&#x27; : &#x27;&#x27;}. These changes help improve and maintain the codebase.`;</span>
<span class="hljs-addition">+    } else if (style === &quot;overview&quot;) {</span>
<span class="hljs-addition">+      return `Summary: ${fileCount} files changed, ${totalAdditions} insertions, ${totalDeletions} deletions.`;</span>
<span class="hljs-addition">+    }</span>
<span class="hljs-addition">+</span>
<span class="hljs-addition">+    return `This commit affects ${fileCount} file${fileCount &gt; 1 ? &#x27;s&#x27; : &#x27;&#x27;} with ${totalAdditions} line addition${totalAdditions !== 1 ? &#x27;s&#x27; : &#x27;&#x27;} and ${totalDeletions} line deletion${totalDeletions !== 1 ? &#x27;s&#x27; : &#x27;&#x27;}. The changes represent a focused modification to the codebase architecture.`;</span>
<span class="hljs-addition">+  }</span>
<span class="hljs-addition">+</span>
<span class="hljs-addition">+  private calculateSectionDuration(file: FileChange, style: string): number {</span>
<span class="hljs-addition">+    const baseTime = style === &quot;beginner&quot; ? 5 : style === &quot;overview&quot; ? 2 : 3;</span>
<span class="hljs-addition">+    const complexityFactor = Math.min(10, (file.additions + file.deletions) / 5);</span>
<span class="hljs-addition">+    return Math.max(baseTime, baseTime + complexityFactor);</span>
<span class="hljs-addition">+  }</span>
<span class="hljs-addition">+</span>
   private generateFileExplanation(file: FileChange, style: string): string {
     const action = file.status <span class="hljs-comment">=== &quot;added&quot; ? &quot;adds&quot; :</span>
       file.status <span class="hljs-comment">=== &quot;deleted&quot; ? &quot;removes&quot; : &quot;modifies&quot;;</span>
 
<span class="hljs-addition">+    const fileExtension = path.extname(file.path);</span>
<span class="hljs-addition">+    const fileName = path.basename(file.path);</span>
<span class="hljs-addition">+    const fileType = this.getFileTypeDescription(fileExtension);</span>
<span class="hljs-addition">+</span>
     if (style <span class="hljs-comment">=== &quot;beginner&quot;) {</span>
<span class="hljs-deletion">-      return `This ${action} the file ${path.basename(file.path)}, making changes to improve the code.`;</span>
<span class="hljs-addition">+      if (file.status === &quot;added&quot;) {</span>
<span class="hljs-addition">+        return `This commit creates a new ${fileType} called ${fileName}. Adding ${file.additions} lines of code, this file introduces new functionality to our project.`;</span>
<span class="hljs-addition">+      } else if (file.status === &quot;deleted&quot;) {</span>
<span class="hljs-addition">+        return `This commit removes the ${fileType} ${fileName}. The file contained ${file.deletions} lines that are no longer needed.`;</span>
<span class="hljs-addition">+      } else {</span>
<span class="hljs-addition">+        return `This commit updates the ${fileType} ${fileName}. It adds ${file.additions} new lines and removes ${file.deletions} existing lines, improving the code&#x27;s functionality.`;</span>
<span class="hljs-addition">+      }</span>
     } else if (style <span class="hljs-comment">=== &quot;overview&quot;) {</span>
<span class="hljs-deletion">-      return `${file.path}: ${file.additions} additions, ${file.deletions} deletions`;</span>
<span class="hljs-addition">+      return `${file.path}: ${file.status} (+${file.additions}/-${file.deletions})`;</span>
     }
 
<span class="hljs-deletion">-    return `${action} ${file.path} with ${file.additions} line additions and ${file.deletions} deletions`;</span>
<span class="hljs-addition">+    // Technical style</span>
<span class="hljs-addition">+    if (file.status === &quot;added&quot;) {</span>
<span class="hljs-addition">+      return `Introduces ${file.path}, a new ${fileType} with ${file.additions} lines implementing core functionality.`;</span>
<span class="hljs-addition">+    } else if (file.status === &quot;deleted&quot;) {</span>
<span class="hljs-addition">+      return `Removes ${file.path}, eliminating ${file.deletions} lines of deprecated ${fileType} code.`;</span>
<span class="hljs-addition">+    } else {</span>
<span class="hljs-addition">+      const netChange = file.additions - file.deletions;</span>
<span class="hljs-addition">+      const changeDescription = netChange &gt; 0 ? `expanding by ${netChange} lines` :</span>
<span class="hljs-addition">+        netChange &lt; 0 ? `reducing by ${Math.abs(netChange)} lines` :</span>
<span class="hljs-addition">+          &quot;with balanced additions and deletions&quot;;</span>
<span class="hljs-addition">+      return `Refactors ${file.path}, ${changeDescription}. This ${fileType} modification includes ${file.additions} additions and ${file.deletions} deletions.`;</span>
<span class="hljs-addition">+    }</span>
<span class="hljs-addition">+  }</span>
<span class="hljs-addition">+</span>
<span class="hljs-addition">+  private getFileTypeDescription(extension: string): string {</span>
<span class="hljs-addition">+    const typeMap: { [key: string]: string } = {</span>
<span class="hljs-addition">+      &#x27;.js&#x27;: &#x27;JavaScript file&#x27;,</span>
<span class="hljs-addition">+      &#x27;.ts&#x27;: &#x27;TypeScript file&#x27;,</span>
<span class="hljs-addition">+      &#x27;.py&#x27;: &#x27;Python script&#x27;,</span>
<span class="hljs-addition">+      &#x27;.java&#x27;: &#x27;Java class&#x27;,</span>
<span class="hljs-addition">+      &#x27;.cpp&#x27;: &#x27;C++ source file&#x27;,</span>
<span class="hljs-addition">+      &#x27;.c&#x27;: &#x27;C source file&#x27;,</span>
<span class="hljs-addition">+      &#x27;.h&#x27;: &#x27;header file&#x27;,</span>
<span class="hljs-addition">+      &#x27;.css&#x27;: &#x27;stylesheet&#x27;,</span>
<span class="hljs-addition">+      &#x27;.html&#x27;: &#x27;HTML document&#x27;,</span>
<span class="hljs-addition">+      &#x27;.json&#x27;: &#x27;configuration file&#x27;,</span>
<span class="hljs-addition">+      &#x27;.md&#x27;: &#x27;documentation file&#x27;,</span>
<span class="hljs-addition">+      &#x27;.yml&#x27;: &#x27;YAML configuration&#x27;,</span>
<span class="hljs-addition">+      &#x27;.yaml&#x27;: &#x27;YAML configuration&#x27;,</span>
<span class="hljs-addition">+      &#x27;.xml&#x27;: &#x27;XML document&#x27;,</span>
<span class="hljs-addition">+      &#x27;.sql&#x27;: &#x27;SQL script&#x27;,</span>
<span class="hljs-addition">+      &#x27;.sh&#x27;: &#x27;shell script&#x27;,</span>
<span class="hljs-addition">+      &#x27;.bat&#x27;: &#x27;batch script&#x27;,</span>
<span class="hljs-addition">+      &#x27;.dockerfile&#x27;: &#x27;Docker configuration&#x27;,</span>
<span class="hljs-addition">+      &#x27;.gitignore&#x27;: &#x27;Git ignore file&#x27;,</span>
<span class="hljs-addition">+      &#x27;.env&#x27;: &#x27;environment file&#x27;,</span>
<span class="hljs-addition">+    };</span>
<span class="hljs-addition">+</span>
<span class="hljs-addition">+    return typeMap[extension.toLowerCase()] || &#x27;file&#x27;;</span>
   }
 
   private async createFrames(commitInfo: any, outputDir: string, theme: string) {
</code></pre>
  </body>
  </html>